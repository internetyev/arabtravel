<div class="uk-grid">
	<div class="uk-width-3-4 uk-margin-bottom">
		<h2>Order <span *ngIf="item">&laquo;{{ item.title }}&raquo;</span></h2>
	</div>
	<div class="uk-width-1-4 uk-margin-bottom">
		<button class="uk-button uk-button-primary uk-align-right" (click)="back()"><i class="uk-icon-arrow-left"></i>&emsp;Back</button>
	</div>
	<div class="uk-width-1-1 uk-form uk-form-stacked">
		<div class="uk-grid">
			<div class="uk-width-1-1 uk-form-controls">
				<label class="uk-button admin-button" [class.uk-active]="item.enable">
					<span>Enable</span>
					<input  class="uk-hidden" type="checkbox" [(ngModel)]="item.enable">
				</label>
				<label class="uk-button admin-button uk-margin-left" [class.uk-active]="item.package">
					<span>Package</span>
					<input class="uk-hidden" type="checkbox" [(ngModel)]="item.package">
				</label>
				<select class="uk-margin-left" name="type" [(ngModel)]="item.status">
					<option *ngFor="let statusItem of statusList" [ngValue]="statusItem">{{ statusItem.title }}</option>
				</select>
			</div>
			<div class="uk-width-7-10">
				<div class="uk-width-1-1 uk-margin-top">
					<label class="uk-form-label uk-width-1-1">Title</label>
					<div class="uk-form-controls">
						<input class="uk-width-1-1" type="text" placeholder="Order title" [(ngModel)]="item.title">
					</div>
				</div>
			</div>
			<div class="uk-width-3-10 uk-margin-top">
				<label class="uk-form-label uk-width-1-1">Date, time</label>
				<div class="uk-form-controls">{{item.date | date: 'dd.MM.yyyy HH:mm:ss' }}</div>
			</div>
			<div class="uk-width-7-10 uk-margin-top">
				<label class="uk-form-label uk-width-1-1">Description</label>
				<div class="uk-form-controls">
					<input class="uk-width-1-1" type="text" placeholder="Order description" [(ngModel)]="item.description">
				</div>
			</div>
			<div class="uk-width-3-10 uk-margin-top">
				<label class="uk-form-label uk-width-1-1">User</label>
				<div class="uk-form-controls" *ngIf="item.owner">
					<a [attr.href]="'/users/' + item.owner.id"  target="_blank">{{item.owner.title}}</a>
				</div>
			</div>

			<div class="uk-width-1-1 uk-grid uk-margin-top">
				<div class="uk-width-1-10">
					<h3 class="tm-article-subtitle">Payment</h3>
				</div>
				<div class="uk-width-9-10 uk-form-controls">
					<select name="type" [(ngModel)]="item.paymentType">
						<option *ngFor="let paymentTypeItem of paymentTypeList" [ngValue]="paymentTypeItem">{{ paymentTypeItem.title }}</option>
					</select>
				</div>
			</div>

			<div class="uk-width-1-1  uk-grid uk-margin-top" [class.uk-hidden]="item.paymentType.id !== 'card'">
				<div class="uk-width-2-10">
					<label class="uk-form-label uk-width-1-1">Card number</label>
					<div class="uk-form-controls">
						<input class="uk-width-1-1" type="text" placeholder="Card number" [(ngModel)]="item.card.number">
					</div>
				</div>
				<div class="uk-width-3-10">
					<label class="uk-form-label uk-width-1-1">Cardholder</label>
					<div class="uk-form-controls">
						<input class="uk-width-1-1" type="text" placeholder="Cardholder" [(ngModel)]="item.card.cardholder">
					</div>
				</div>
				<div class="uk-width-2-10">
					<label class="uk-form-label uk-width-1-1">Month/Year</label>
					<div class="uk-form-controls">
						<select [(ngModel)]="item.card.validMonth">
							<option *ngFor="let month of months" [ngValue]="month">{{month}}</option>
						</select>
						<select [(ngModel)]="item.card.validYear">
							<option *ngFor="let year of years" [ngValue]="year">{{year}}</option>
						</select>
					</div>
				</div>
				<div class="uk-width-1-10">
					<label class="uk-form-label uk-width-1-1">CVV</label>
					<div class="uk-form-controls">
						<input class="uk-width-1-1" type="number" min="100" max="999" placeholder="CVV" [(ngModel)]="item.card.cvv">
					</div>
				</div>
			</div>

			<div class="uk-width-1-1 uk-grid uk-margin-top">
				<div class="uk-width-8-10">
					<h3 class="tm-article-subtitle">Passengers</h3>
				</div>
				<div class="uk-width-2-10">
					<a class="uk-align-right admin-cursor-pointer" (click)="addHuman(); $event.stopPropagation()">
						<i class="uk-icon uk-icon-plus-circle uk-margin-small-right"></i>
						<u>Add passenger</u>
					</a>
				</div>
			</div>
			<div class="uk-width-1-1 uk-margin-top">
				<div  *ngFor="let human of item.people; let i = index;" class="uk-panel uk-panel-box uk-width-1-1">
					<div class="uk-panel-badge uk-badge uk-badge-danger admin-cursor-pointer" (click)="deleteHuman(human); $event.stopPropagation()"><i class="uk-icon-trash"></i></div>
					<h3 class="uk-panel-title">Passenger #{{ i + 1 }}</h3>
					<order-human [(human)]="item.people[i]"></order-human>
				</div>
			</div>

			<div class="uk-width-1-1 uk-grid uk-margin-top">
				<div class="uk-width-8-10">
					<h3 class="tm-article-subtitle">Shifts</h3>
				</div>
				<div class="uk-width-2-10">
					<a class="uk-align-right admin-cursor-pointer" (click)="addShift(); $event.stopPropagation()">
						<i class="uk-icon uk-icon-plus-circle uk-margin-small-right"></i>
						<u>Add shift</u>
					</a>
				</div>
			</div>
			<div class="uk-width-1-1 uk-margin-top">
				<div  *ngFor="let shift of item.shifts; let i = index;" class="uk-panel uk-panel-box uk-width-1-1">
					<div class="uk-panel-badge uk-badge uk-badge-danger admin-cursor-pointer" (click)="deleteShift(shift); $event.stopPropagation()"><i class="uk-icon-trash"></i></div>
					<h3 class="uk-panel-title">
						<span>{{ shift.date | date: 'dd.MM.yyyy' }},&nbsp;</span>
						<span *ngIf="shift.trip && shift.trip.pointA">{{ shift.trip.pointA.title }}</span>
						<span *ngIf="shift.trip && shift.trip.pointB">&nbsp;&rarr;&nbsp;{{ shift.trip.pointB.title }}</span>
					</h3>
					<order-shift [(shift)]="item.shifts[i]"></order-shift>
				</div>
			</div>

			<div class="uk-width-1-1 uk-grid uk-margin-top" [class.uk-hidden]="!item.package">
				<div class="uk-width-1-1">
					<h3 class="tm-article-subtitle">Hotel data</h3>
				</div>
				<div class="uk-width-1-2 uk-margin-top">
					<b>Hotel:</b>
					<select name="type" [(ngModel)]="item.hotel" (change)="hotelChange();">
						<option [ngValue]="null">None</option>
						<option *ngIf="item.hotel" [ngValue]="item.hotel">{{ item.hotel.title }} (Current)</option>
						<option *ngFor="let hotelItem of hotels" [ngValue]="hotelItem">{{ hotelItem.title }}</option>
					</select>
					<label class="uk-form-label uk-width-1-1 uk-margin-top" *ngIf="item.hotel">Options:</label>
					<ul class="uk-width-1-1 uk-list" *ngIf="item.hotel">
						<li *ngFor="let option of item.hotel.options | listOrderBy : ['title']">
							<input type="checkbox" [(ngModel)]="option.enable">
							{{ option.title }}
							<input type="number" min="0" [(ngModel)]="option.cost">
						</li>
					</ul>
				</div>
				<div class="uk-width-1-2 uk-margin-top" *ngIf="item.hotel">
					<b>Room:</b>
					<select name="type" [(ngModel)]="item.room">
						<option [ngValue]="null">None</option>
						<option *ngIf="item.room" [ngValue]="item.room">{{ item.room.title }} (Current)</option>
						<option *ngFor="let roomItem of item.hotel.rooms" [ngValue]="roomItem">{{ roomItem.title }}</option>
					</select>
					<div class="uk-width-1-1 uk-margin-top" *ngIf="item.room">
						<b>Size:</b>
						<span>{{item.room.size}}</span>
						<b class="uk-margin-left">Beds:</b>
						<span>{{item.room.beds}}</span>
						<b class="uk-margin-left">Cost:</b>
						<input class="" type="number" min="0" [(ngModel)]="item.room.cost">
						<label class="uk-form-label uk-width-1-1 uk-margin-top">Options:</label>
						<ul class="uk-width-1-1 uk-list" *ngIf="item.room">
							<li *ngFor="let option of item.room.options | listOrderBy : ['title']">
								<input type="checkbox" [(ngModel)]="option.enable">
								{{ option.title }}
								<input type="number" min="0" [(ngModel)]="option.cost">
							</li>
						</ul>
					</div>
				</div>
			</div>
			<div class="uk-width-1-1 uk-margin-top">
				<h3 class="tm-article-subtitle">Global paremetrs</h3>
			</div>
			<div class="uk-width-2-10">
				<label class="uk-form-label uk-width-1-1">Processing fee</label>
				<div class="uk-form-controls">
					<input class="uk-width-1-1" type="number" min="0" [(ngModel)]="item.processingFee">
				</div>
			</div>
			<div class="uk-width-2-10">
				<label class="uk-form-label uk-width-1-1">Egyptian mark up</label>
				<div class="uk-form-controls">
					<input class="uk-width-1-1" type="number" min="0" [(ngModel)]="item.egyptianMarkUp">
				</div>
			</div>
			<div class="uk-width-2-10">
				<label class="uk-form-label uk-width-1-1">Exchange rate</label>
				<div class="uk-form-controls">
					<input class="uk-width-1-1" type="number" min="0" [(ngModel)]="item.exchangeRate">
				</div>
			</div>
			<div class="uk-width-1-1 uk-margin-top">
				<h3 class="tm-article-subtitle">Calculation</h3>
			</div>
			<div class="uk-width-1-1 uk-margin-top">
				<table class="uk-table uk-table-hover uk-table-condensed">
					<thead>
						<tr>
							<th>#</th>
							<th>Type</th>
							<th>Content</th>
							<th>Cost</th>
							<th>Sum</th>
						</tr>
					</thead>
					<tbody>
						<tr *ngFor="let shift of item.sortedShifts">
							<td></td>
							<td>Shift</td>
							<td>
								<span>{{ shift.date | date: 'dd.MM.yyyy'}}</span>
								<span *ngIf="shift.trip && shift.trip.pointA">,&emsp;{{ shift.trip.pointA.title }}</span>
								<span *ngIf="shift.trip && shift.trip.pointB">&ensp;&rarr;&ensp;{{ shift.trip.pointB.title }}</span>
							</td>
							<td>
								<div *ngFor="let peopleCount of item.getPeopleCounts(shift.date)">
									<span>{{ peopleCount.ageGroup.title }}</span>
									<span class="uk-margin-small-left">{{ peopleCount.count }}&nbsp;x&nbsp;{{ shift.price && shift.price.getCost(peopleCount.ageGroup) || 0 }}</span>
								</div>
								<div *ngIf="shift.vehicle">
									<span>{{ shift.vehicle.title }}</span>
									<span class="uk-margin-small-left">1&nbsp;x&nbsp;{{ shift.price && shift.price.getVehicleCost(shift.vehicle) }}</span>
								</div>
							</td>
							<td>{{ item.getShiftCost(shift) }}</td>
						</tr>
						<tr *ngIf="item.hotel">
							<td></td>
							<td>Hotel</td>
							<td>
								<span>{{ item.hotel.title }}</span>
								<span *ngIf="item.from">,&emsp;from: {{ item.from | date: 'dd.MM.yyyy' }}</span>
								<span *ngIf="item.to">&nbsp;to: {{ item.to | date: 'dd.MM.yyyy' }}</span>
								<span *ngIf="item.room">,&emsp;{{ item.room.title }}</span>
							</td>
							<td>
								<div *ngIf="item.room">
									<div>
										<span>Room</span>
										<span class="uk-margin-small-left">{{ item.duration }}&nbsp;x&nbsp;{{ item.room.cost }}</span>
									</div>
									<div *ngFor="let option of item.room.enabledOptions">
										<span>{{ option.title }}</span>
										<span class="uk-margin-small-left">{{ item.duration }}&nbsp;x&nbsp;{{ option.cost }}</span>
									</div>
								</div>
								<div *ngFor="let option of item.hotel.enabledOptions">
									<span>{{ option.title }}</span>
									<span class="uk-margin-small-left">1&nbsp;x&nbsp;{{ option.cost }}</span>
								</div>
							</td>
							<td>{{ item.hotelCost }}</td>
						</tr>
					</tbody>
					<tfoot>
						<tr>
							<td colspan="4" class="uk-text-right"><b>Full sum:</b></td>
							<td><b>{{ item.fullCost }}</b></td>
						</tr>
						<tr>
							<td colspan="4" class="uk-text-right"><b>Processing fee:</b></td>
							<td><b>{{ item.processingFee }}</b></td>
						</tr>
						<tr>
							<td colspan="4" class="uk-text-right"><b>Total cost:</b></td>
							<td><b>{{ item.totalCost }}</b></td>
						</tr>
					</tfoot>
				</table>
			</div>

			<div class="uk-width-1-1 uk-margin-top">
				<button type="submit" class="uk-button uk-button-success uk-align-right" (click)="submit()"><i class="uk-icon-floppy-o"></i>&emsp;Submit</button>
			</div>
			<!-- <div class="uk-width-1-1 uk-margin-top">
				<p>DEBUG: {{ item | json }}</p>
			</div> -->
		</div>
	</div>
</div>
